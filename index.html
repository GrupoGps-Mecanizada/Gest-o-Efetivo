<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o de Efetivo - GrupoGPS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #16a34a;
            --warning: #ca8a04;
            --danger: #dc2626;
            --info: #0891b2;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--white);
        }

        .sidebar-brand {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sidebar-menu {
            padding: 1rem 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--gray-700);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .menu-item:hover {
            background: var(--gray-100);
            color: var(--primary);
        }

        .menu-item.active {
            background: var(--primary);
            color: var(--white);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            margin-left: 260px;
            background: var(--gray-50);
        }

        .header {
            background: var(--white);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .page-content {
            padding: 2rem;
            display: none;
        }

        .page-content.active {
            display: block;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--gray-900);
        }

        .page-subtitle {
            color: var(--gray-600);
            margin-bottom: 2rem;
        }

        .card {
            background: var(--white);
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--white);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 1rem;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--gray-200);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--gray-50);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-200);
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-100);
        }

        .table tr:hover {
            background: var(--gray-50);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 0.75rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-500);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(22, 163, 74, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(202, 138, 4, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(220, 38, 38, 0.1);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(8, 145, 178, 0.1);
            color: var(--info);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .stat-card-title {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .stat-card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .escala-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        .escala-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary);
        }

        .escala-supervisor {
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }

        .escala-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .escala-funcionarios {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: var(--white);
            font-weight: 600;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--gray-500);
        }

        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-brand">
                    <i class="fas fa-users-cog"></i>
                    Sistema GrupoGPS
                </div>
            </div>
            
            <div class="sidebar-menu">
                <button class="menu-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </button>
                
                <button class="menu-item" onclick="showPage('funcionarios')">
                    <i class="fas fa-users"></i>
                    Funcion√°rios
                </button>
                
                <button class="menu-item" onclick="showPage('escalas')">
                    <i class="fas fa-calendar-alt"></i>
                    Escalas
                </button>
                
                <button class="menu-item" onclick="showPage('faltas')">
                    <i class="fas fa-user-times"></i>
                    Faltas
                </button>
                
                <button class="menu-item" onclick="showPage('atestados')">
                    <i class="fas fa-file-medical"></i>
                    Atestados
                </button>
                
                <button class="menu-item" onclick="showPage('ferias')">
                    <i class="fas fa-umbrella-beach"></i>
                    F√©rias
                </button>
                
                <button class="menu-item" onclick="showPage('treinamentos')">
                    <i class="fas fa-graduation-cap"></i>
                    Treinamentos
                </button>
                
                <button class="menu-item" onclick="showPage('relatorios')">
                    <i class="fas fa-chart-bar"></i>
                    Relat√≥rios
                </button>
                
                <button class="menu-item" onclick="showPage('configuracoes')">
                    <i class="fas fa-cog"></i>
                    Configura√ß√µes
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <h1>Sistema de Gest√£o de Efetivo</h1>
            </header>

            <!-- Dashboard -->
            <div id="dashboard" class="page-content active">
                <h2 class="page-title">Dashboard</h2>
                <p class="page-subtitle">Vis√£o geral do efetivo</p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-title">Total de Funcion√°rios</div>
                        <div class="stat-card-value" id="totalFuncionarios">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-title">Funcion√°rios Ativos</div>
                        <div class="stat-card-value" id="funcionariosAtivos">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-title">Em F√©rias</div>
                        <div class="stat-card-value" id="funcionariosFerias">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-title">Afastados</div>
                        <div class="stat-card-value" id="funcionariosAfastados">0</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-bell"></i>
                            Alertas Importantes
                        </h3>
                    </div>
                    <div class="card-body" id="alertasContainer">
                        <p class="text-center text-muted">Nenhum alerta no momento</p>
                    </div>
                </div>
            </div>

            <!-- Funcion√°rios -->
            <div id="funcionarios" class="page-content">
                <h2 class="page-title">Funcion√°rios</h2>
                <p class="page-subtitle">Gest√£o completa do efetivo</p>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Lista de Funcion√°rios</h3>
                        <button class="btn btn-primary" onclick="openModal('funcionarioModal')">
                            <i class="fas fa-plus"></i>
                            Novo Funcion√°rio
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Matr√≠cula</th>
                                        <th>Fun√ß√£o</th>
                                        <th>Supervisor</th>
                                        <th>Equipamento</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="funcionariosTable">
                                    <tr>
                                        <td colspan="7" class="text-center text-muted">Nenhum funcion√°rio cadastrado</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Escalas -->
            <div id="escalas" class="page-content">
                <h2 class="page-title">Escalas</h2>
                <p class="page-subtitle">Controle de turnos e supervisores</p>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Consultar Escala</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: flex; gap: 1rem; align-items: end; margin-bottom: 2rem;">
                            <div style="flex: 1;">
                                <label class="form-label">Data de Consulta</label>
                                <input type="date" id="dataEscala" class="form-input" onchange="calcularEscalas()">
                            </div>
                            <button class="btn btn-primary" onclick="calcularEscalas()">
                                <i class="fas fa-search"></i>
                                Consultar
                            </button>
                            <button class="btn btn-secondary" onclick="setHoje()">
                                Hoje
                            </button>
                        </div>

                        <div id="escalasResult">
                            <p class="text-center text-muted">Selecione uma data para consultar a escala</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Faltas -->
            <div id="faltas" class="page-content">
                <h2 class="page-title">Faltas</h2>
                <p class="page-subtitle">Registro e controle de faltas</p>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Registro de Faltas</h3>
                        <button class="btn btn-primary" onclick="openModal('faltaModal')">
                            <i class="fas fa-plus"></i>
                            Registrar Falta
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Funcion√°rio</th>
                                        <th>Motivo</th>
                                        <th>Cobertura</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="faltasTable">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">Nenhuma falta registrada</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Atestados -->
            <div id="atestados" class="page-content">
                <h2 class="page-title">Atestados</h2>
                <p class="page-subtitle">Controle de atestados m√©dicos</p>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Atestados M√©dicos</h3>
                        <button class="btn btn-primary" onclick="openModal('atestadoModal')">
                            <i class="fas fa-plus"></i>
                            Novo Atestado
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Funcion√°rio</th>
                                        <th>Data In√≠cio</th>
                                        <th>Data Fim</th>
                                        <th>Dias</th>
                                        <th>CID</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="atestadosTable">
                                    <tr>
                                        <td colspan="7" class="text-center text-muted">Nenhum atestado registrado</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- F√©rias -->
            <div id="ferias" class="page-content">
                <h2 class="page-title">F√©rias</h2>
                <p class="page-subtitle">Controle de per√≠odos de f√©rias</p>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Per√≠odos de F√©rias</h3>
                        <button class="btn btn-primary" onclick="openModal('feriasModal')">
                            <i class="fas fa-plus"></i>
                            Novo Per√≠odo
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Funcion√°rio</th>
                                        <th>Data In√≠cio</th>
                                        <th>Data Fim</th>
                                        <th>Dias</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="feriasTable">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">Nenhum per√≠odo registrado</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Treinamentos -->
            <div id="treinamentos" class="page-content">
                <h2 class="page-title">Treinamentos</h2>
                <p class="page-subtitle">Controle de treinamentos e validades</p>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Treinamentos</h3>
                        <button class="btn btn-primary" onclick="openModal('treinamentoModal')">
                            <i class="fas fa-plus"></i>
                            Novo Treinamento
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Funcion√°rio</th>
                                        <th>Tipo</th>
                                        <th>Data Realiza√ß√£o</th>
                                        <th>Vencimento</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="treinamentosTable">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">Nenhum treinamento registrado</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relat√≥rios -->
            <div id="relatorios" class="page-content">
                <h2 class="page-title">Relat√≥rios</h2>
                <p class="page-subtitle">Relat√≥rios e an√°lises</p>

                <div class="stats-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Relat√≥rio por Supervisor</h3>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary" onclick="gerarRelatorioSupervisor()">
                                <i class="fas fa-file-pdf"></i>
                                Gerar Relat√≥rio
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Relat√≥rio de Faltas</h3>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary" onclick="gerarRelatorioFaltas()">
                                <i class="fas fa-file-pdf"></i>
                                Gerar Relat√≥rio
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Relat√≥rio de Treinamentos</h3>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-primary" onclick="gerarRelatorioTreinamentos()">
                                <i class="fas fa-file-pdf"></i>
                                Gerar Relat√≥rio
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes -->
            <div id="configuracoes" class="page-content">
                <h2 class="page-title">Configura√ß√µes</h2>
                <p class="page-subtitle">Configura√ß√µes do sistema e integra√ß√£o</p>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-cloud"></i>
                            Integra√ß√£o Google Sheets
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">URL do Apps Script</label>
                                <input type="url" id="appsScriptUrl" class="form-input" 
                                       placeholder="https://script.google.com/...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ID da Planilha</label>
                                <input type="text" id="spreadsheetId" class="form-input" 
                                       placeholder="ID da planilha Google Sheets">
                            </div>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-primary" onclick="salvarConfiguracao()">
                                <i class="fas fa-save"></i>
                                Salvar
                            </button>
                            <button class="btn btn-success" onclick="testarConexao()">
                                <i class="fas fa-check"></i>
                                Testar
                            </button>
                            <button class="btn btn-warning" onclick="sincronizar()">
                                <i class="fas fa-sync"></i>
                                Sincronizar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-database"></i>
                            Backup de Dados
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-secondary" onclick="fazerBackup()">
                                <i class="fas fa-download"></i>
                                Fazer Backup
                            </button>
                            <button class="btn btn-secondary" onclick="document.getElementById('backupFile').click()">
                                <i class="fas fa-upload"></i>
                                Restaurar Backup
                            </button>
                            <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="restaurarBackup(this)">
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Funcion√°rio -->
    <div class="modal" id="funcionarioModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Cadastro Completo de Funcion√°rio</h3>
                <button class="modal-close" onclick="closeModal('funcionarioModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="funcionarioForm">
                    <h4>Dados Pessoais</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Nome Completo *</label>
                            <input type="text" id="funcNome" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">CPF</label>
                            <input type="text" id="funcCpf" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data de Nascimento</label>
                            <input type="date" id="funcNascimento" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefone</label>
                            <input type="tel" id="funcTelefone" class="form-input">
                        </div>
                    </div>

                    <h4 style="margin-top: 2rem;">Dados Profissionais</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Matr√≠cula *</label>
                            <input type="text" id="funcMatricula" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fun√ß√£o *</label>
                            <select id="funcFuncao" class="form-select" required>
                                <option value="">Selecione</option>
                                <option value="Supervisor">Supervisor</option>
                                <option value="Motorista">Motorista</option>
                                <option value="Operador">Operador</option>
                                <option value="T√©cnico">T√©cnico</option>
                                <option value="Administrativo">Administrativo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Supervisor</label>
                            <select id="funcSupervisor" class="form-select">
                                <option value="">Selecione</option>
                                <option value="A">Letra A - Ozias</option>
                                <option value="B">Letra B - Matoza</option>
                                <option value="C">Letra C - Israel</option>
                                <option value="D">Letra D - Wellison</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Equipamento</label>
                            <input type="text" id="funcEquipamento" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Escala</label>
                            <select id="funcEscala" class="form-select">
                                <option value="">Selecione</option>
                                <option value="4x4">4x4 (4 trabalho, 4 folga)</option>
                                <option value="6x3">6x3 (6 trabalho, 3 folga)</option>
                                <option value="12x36">12x36 (12h trabalho, 36h folga)</option>
                                <option value="ADM">Administrativo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data de Admiss√£o</label>
                            <input type="date" id="funcAdmissao" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select id="funcStatus" class="form-select">
                                <option value="Ativo">Ativo</option>
                                <option value="F√©rias">F√©rias</option>
                                <option value="Afastado">Afastado</option>
                                <option value="Desligado">Desligado</option>
                            </select>
                        </div>
                    </div>

                    <h4 style="margin-top: 2rem;">Documentos e Exames</h4>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">ASO - Vencimento</label>
                            <input type="date" id="funcAso" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Carteira de Habilita√ß√£o</label>
                            <select id="funcCnh" class="form-select">
                                <option value="">N√£o possui</option>
                                <option value="A">Categoria A</option>
                                <option value="B">Categoria B</option>
                                <option value="C">Categoria C</option>
                                <option value="D">Categoria D</option>
                                <option value="E">Categoria E</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Vencimento CNH</label>
                            <input type="date" id="funcCnhVenc" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea id="funcObservacoes" class="form-textarea" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('funcionarioModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarFuncionario()">
                    <i class="fas fa-save"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Falta -->
    <div class="modal" id="faltaModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Registrar Falta</h3>
                <button class="modal-close" onclick="closeModal('faltaModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="faltaForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Data *</label>
                            <input type="date" id="faltaData" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Funcion√°rio *</label>
                            <select id="faltaFuncionario" class="form-select" required>
                                <option value="">Selecione</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Motivo *</label>
                            <select id="faltaMotivo" class="form-select" required>
                                <option value="">Selecione</option>
                                <option value="Atestado M√©dico">Atestado M√©dico</option>
                                <option value="Falta Justificada">Falta Justificada</option>
                                <option value="Falta Injustificada">Falta Injustificada</option>
                                <option value="Licen√ßa">Licen√ßa</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Cobertura</label>
                            <select id="faltaCobertura" class="form-select">
                                <option value="">Ningu√©m</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea id="faltaObservacoes" class="form-textarea" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('faltaModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarFalta()">
                    <i class="fas fa-save"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Atestado -->
    <div class="modal" id="atestadoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Registrar Atestado</h3>
                <button class="modal-close" onclick="closeModal('atestadoModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="atestadoForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Funcion√°rio *</label>
                            <select id="atestadoFuncionario" class="form-select" required>
                                <option value="">Selecione</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data In√≠cio *</label>
                            <input type="date" id="atestadoInicio" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data Fim *</label>
                            <input type="date" id="atestadoFim" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">CID</label>
                            <input type="text" id="atestadoCid" class="form-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea id="atestadoObservacoes" class="form-textarea" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('atestadoModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarAtestado()">
                    <i class="fas fa-save"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal F√©rias -->
    <div class="modal" id="feriasModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Registrar F√©rias</h3>
                <button class="modal-close" onclick="closeModal('feriasModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="feriasForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Funcion√°rio *</label>
                            <select id="feriasFuncionario" class="form-select" required>
                                <option value="">Selecione</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data In√≠cio *</label>
                            <input type="date" id="feriasInicio" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data Fim *</label>
                            <input type="date" id="feriasFim" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select id="feriasStatus" class="form-select">
                                <option value="Programado">Programado</option>
                                <option value="Em andamento">Em andamento</option>
                                <option value="Conclu√≠do">Conclu√≠do</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea id="feriasObservacoes" class="form-textarea" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('feriasModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarFerias()">
                    <i class="fas fa-save"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Treinamento -->
    <div class="modal" id="treinamentoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Registrar Treinamento</h3>
                <button class="modal-close" onclick="closeModal('treinamentoModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="treinamentoForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Funcion√°rio *</label>
                            <select id="treinamentoFuncionario" class="form-select" required>
                                <option value="">Selecione</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tipo de Treinamento *</label>
                            <select id="treinamentoTipo" class="form-select" required>
                                <option value="">Selecione</option>
                                <option value="NR10">NR10 - Eletricidade</option>
                                <option value="NR33">NR33 - Espa√ßo Confinado</option>
                                <option value="NR35">NR35 - Trabalho em Altura</option>
                                <option value="Dire√ß√£o Defensiva">Dire√ß√£o Defensiva</option>
                                <option value="Primeiros Socorros">Primeiros Socorros</option>
                                <option value="MOPP">MOPP</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data de Realiza√ß√£o *</label>
                            <input type="date" id="treinamentoData" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Validade (meses)</label>
                            <select id="treinamentoValidade" class="form-select" onchange="calcularVencimento()">
                                <option value="">N√£o vence</option>
                                <option value="12">12 meses</option>
                                <option value="24">24 meses</option>
                                <option value="36">36 meses</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Data de Vencimento</label>
                            <input type="date" id="treinamentoVencimento" class="form-input" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea id="treinamentoObservacoes" class="form-textarea" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('treinamentoModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarTreinamento()">
                    <i class="fas fa-save"></i>
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <script>
        // SISTEMA COMPLETO DE GEST√ÉO DE EFETIVO
        
        // Estado global do sistema
        let sistemaData = {
            funcionarios: [],
            faltas: [],
            atestados: [],
            ferias: [],
            treinamentos: [],
            config: {
                appsScriptUrl: '',
                spreadsheetId: ''
            }
        };

        // Configura√ß√µes de escala dos supervisores
        const ESCALAS = {
            'A': { // Ozias
                nome: 'Ozias',
                ciclo: [1,1,1,1,0,0,0,0], // 4 trabalho, 4 folga
                inicio: new Date('2025-01-01') // Data de refer√™ncia
            },
            'B': { // Matoza  
                nome: 'Matoza',
                ciclo: [0,0,1,1,1,1,0,0], // Defasado 2 dias
                inicio: new Date('2025-01-01')
            },
            'C': { // Israel
                nome: 'Israel', 
                ciclo: [0,0,0,0,1,1,1,1], // Defasado 4 dias
                inicio: new Date('2025-01-01')
            },
            'D': { // Wellison
                nome: 'Wellison',
                ciclo: [1,1,0,0,0,0,1,1], // Defasado 6 dias
                inicio: new Date('2025-01-01')
            }
        };

        // Inicializa√ß√£o do sistema
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Sistema GrupoGPS carregado');
            carregarDados();
            atualizarDashboard();
            setHoje();
        });

        // NAVEGA√á√ÉO
        function showPage(pageId) {
            // Esconder todas as p√°ginas
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remover active de todos os menus
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Mostrar p√°gina selecionada
            document.getElementById(pageId).classList.add('active');
            
            // Ativar menu correspondente
            event.target.classList.add('active');
            
            // Atualizar conte√∫do espec√≠fico da p√°gina
            if (pageId === 'funcionarios') {
                renderizarFuncionarios();
            } else if (pageId === 'faltas') {
                renderizarFaltas();
            } else if (pageId === 'atestados') {
                renderizarAtestados();
            } else if (pageId === 'ferias') {
                renderizarFerias();
            } else if (pageId === 'treinamentos') {
                renderizarTreinamentos();
            } else if (pageId === 'dashboard') {
                atualizarDashboard();
            }
        }

        // MODALS
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('show');
            
            // Carregar funcion√°rios nos selects se necess√°rio
            if (modalId === 'faltaModal' || modalId === 'atestadoModal' || modalId === 'feriasModal' || modalId === 'treinamentoModal') {
                carregarFuncionariosSelect(modalId);
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            
            // Limpar formul√°rio
            const form = modal.querySelector('form');
            if (form) {
                form.reset();
            }
        }

        function carregarFuncionariosSelect(modalId) {
            const funcionariosAtivos = sistemaData.funcionarios.filter(f => f.status === 'Ativo');
            
            let selectId = '';
            let selectCobertura = null;
            
            switch(modalId) {
                case 'faltaModal':
                    selectId = 'faltaFuncionario';
                    selectCobertura = document.getElementById('faltaCobertura');
                    break;
                case 'atestadoModal':
                    selectId = 'atestadoFuncionario';
                    break;
                case 'feriasModal':
                    selectId = 'feriasFuncionario';
                    break;
                case 'treinamentoModal':
                    selectId = 'treinamentoFuncionario';
                    break;
            }
            
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Selecione</option>';
            
            funcionariosAtivos.forEach(func => {
                const option = document.createElement('option');
                option.value = func.id;
                option.textContent = `${func.nome} - ${func.matricula}`;
                select.appendChild(option);
            });
            
            // Preencher select de cobertura se existir
            if (selectCobertura) {
                selectCobertura.innerHTML = '<option value="">Ningu√©m</option>';
                funcionariosAtivos.forEach(func => {
                    const option = document.createElement('option');
                    option.value = func.id;
                    option.textContent = `${func.nome} - ${func.matricula}`;
                    selectCobertura.appendChild(option);
                });
            }
        }

        // FUNCION√ÅRIOS
        function salvarFuncionario() {
            const funcionario = {
                id: Date.now(),
                nome: document.getElementById('funcNome').value,
                cpf: document.getElementById('funcCpf').value,
                nascimento: document.getElementById('funcNascimento').value,
                telefone: document.getElementById('funcTelefone').value,
                matricula: document.getElementById('funcMatricula').value,
                funcao: document.getElementById('funcFuncao').value,
                supervisor: document.getElementById('funcSupervisor').value,
                equipamento: document.getElementById('funcEquipamento').value,
                escala: document.getElementById('funcEscala').value,
                admissao: document.getElementById('funcAdmissao').value,
                status: document.getElementById('funcStatus').value,
                aso: document.getElementById('funcAso').value,
                cnh: document.getElementById('funcCnh').value,
                cnhVenc: document.getElementById('funcCnhVenc').value,
                observacoes: document.getElementById('funcObservacoes').value,
                dataCadastro: new Date().toISOString()
            };

            // Valida√ß√£o b√°sica
            if (!funcionario.nome || !funcionario.matricula || !funcionario.funcao) {
                showNotification('Preencha os campos obrigat√≥rios', 'error');
                return;
            }

            sistemaData.funcionarios.push(funcionario);
            salvarDados();
            renderizarFuncionarios();
            atualizarDashboard();
            closeModal('funcionarioModal');
            showNotification('Funcion√°rio cadastrado com sucesso!', 'success');
        }

        function renderizarFuncionarios() {
            const tbody = document.getElementById('funcionariosTable');
            
            if (sistemaData.funcionarios.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">Nenhum funcion√°rio cadastrado</td></tr>';
                return;
            }

            tbody.innerHTML = sistemaData.funcionarios.map(func => `
                <tr>
                    <td>${func.nome}</td>
                    <td>${func.matricula}</td>
                    <td>${func.funcao}</td>
                    <td>${func.supervisor ? `Letra ${func.supervisor} - ${ESCALAS[func.supervisor]?.nome}` : '-'}</td>
                    <td>${func.equipamento || '-'}</td>
                    <td><span class="badge badge-${getBadgeClass(func.status)}">${func.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="excluirFuncionario(${func.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function excluirFuncionario(id) {
            if (confirm('Confirma a exclus√£o deste funcion√°rio?')) {
                sistemaData.funcionarios = sistemaData.funcionarios.filter(f => f.id !== id);
                salvarDados();
                renderizarFuncionarios();
                atualizarDashboard();
                showNotification('Funcion√°rio exclu√≠do', 'success');
            }
        }

        // ESCALAS
        function setHoje() {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataEscala').value = hoje;
            calcularEscalas();
        }

        function calcularEscalas() {
            const dataInput = document.getElementById('dataEscala');
            if (!dataInput.value) {
                showNotification('Selecione uma data', 'warning');
                return;
            }

            const dataConsulta = new Date(dataInput.value);
            const resultContainer = document.getElementById('escalasResult');
            
            // Calcular posi√ß√£o no ciclo para cada supervisor
            const resultados = Object.keys(ESCALAS).map(letra => {
                const supervisor = ESCALAS[letra];
                const diasDiff = Math.floor((dataConsulta - supervisor.inicio) / (1000 * 60 * 60 * 24));
                const posicao = diasDiff % 8; // Ciclo de 8 dias
                const trabalhando = supervisor.ciclo[posicao] === 1;
                
                // Buscar funcion√°rios deste supervisor
                const funcionarios = sistemaData.funcionarios.filter(f => 
                    f.supervisor === letra && f.status === 'Ativo'
                );
                
                return {
                    letra,
                    nome: supervisor.nome,
                    trabalhando,
                    turno: trabalhando ? 'Diurno' : 'Folga',
                    funcionarios
                };
            });

            // Renderizar resultado
            resultContainer.innerHTML = `
                <div class="escala-grid">
                    ${resultados.map(sup => `
                        <div class="escala-card" style="border-left-color: ${sup.trabalhando ? 'var(--success)' : 'var(--warning)'}">
                            <div class="escala-supervisor">
                                Supervisor ${sup.nome} (Letra ${sup.letra})
                            </div>
                            <div class="escala-status">
                                <span class="badge badge-${sup.trabalhando ? 'success' : 'warning'}">
                                    <i class="fas fa-${sup.trabalhando ? 'check' : 'clock'}"></i>
                                    ${sup.turno}
                                </span>
                            </div>
                            <div class="escala-funcionarios">
                                <strong>Funcion√°rios (${sup.funcionarios.length}):</strong><br>
                                ${sup.funcionarios.length > 0 
                                    ? sup.funcionarios.map(f => `‚Ä¢ ${f.nome}`).join('<br>')
                                    : 'Nenhum funcion√°rio'
                                }
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // FALTAS
        function salvarFalta() {
            const funcionarioId = document.getElementById('faltaFuncionario').value;
            const funcionario = sistemaData.funcionarios.find(f => f.id == funcionarioId);
            
            const coberturaId = document.getElementById('faltaCobertura').value;
            const cobertura = coberturaId ? sistemaData.funcionarios.find(f => f.id == coberturaId) : null;

            const falta = {
                id: Date.now(),
                data: document.getElementById('faltaData').value,
                funcionarioId: funcionarioId,
                funcionarioNome: funcionario?.nome || '',
                motivo: document.getElementById('faltaMotivo').value,
                coberturaId: coberturaId || null,
                coberturaNome: cobertura?.nome || '',
                observacoes: document.getElementById('faltaObservacoes').value,
                dataCadastro: new Date().toISOString()
            };

            if (!falta.data || !falta.funcionarioId || !falta.motivo) {
                showNotification('Preencha os campos obrigat√≥rios', 'error');
                return;
            }

            sistemaData.faltas.push(falta);
            salvarDados();
            renderizarFaltas();
            closeModal('faltaModal');
            showNotification('Falta registrada com sucesso!', 'success');
        }

        function renderizarFaltas() {
            const tbody = document.getElementById('faltasTable');
            
            if (sistemaData.faltas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">Nenhuma falta registrada</td></tr>';
                return;
            }

            // Ordenar por data (mais recente primeiro)
            const faltasOrdenadas = sistemaData.faltas.sort((a, b) => new Date(b.data) - new Date(a.data));

            tbody.innerHTML = faltasOrdenadas.map(falta => `
                <tr>
                    <td>${formatarData(falta.data)}</td>
                    <td>${falta.funcionarioNome}</td>
                    <td><span class="badge badge-${getMotivoBadge(falta.motivo)}">${falta.motivo}</span></td>
                    <td>${falta.coberturaNome || '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="excluirFalta(${falta.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function excluirFalta(id) {
            if (confirm('Confirma a exclus√£o desta falta?')) {
                sistemaData.faltas = sistemaData.faltas.filter(f => f.id !== id);
                salvarDados();
                renderizarFaltas();
                showNotification('Falta exclu√≠da', 'success');
            }
        }

        // ATESTADOS
        function salvarAtestado() {
            const funcionarioId = document.getElementById('atestadoFuncionario').value;
            const funcionario = sistemaData.funcionarios.find(f => f.id == funcionarioId);
            
            const dataInicio = document.getElementById('atestadoInicio').value;
            const dataFim = document.getElementById('atestadoFim').value;
            
            // Calcular dias
            const inicio = new Date(dataInicio);
            const fim = new Date(dataFim);
            const dias = Math.ceil((fim - inicio) / (1000 * 60 * 60 * 24)) + 1;

            const atestado = {
                id: Date.now(),
                funcionarioId: funcionarioId,
                funcionarioNome: funcionario?.nome || '',
                dataInicio: dataInicio,
                dataFim: dataFim,
                dias: dias,
                cid: document.getElementById('atestadoCid').value,
                observacoes: document.getElementById('atestadoObservacoes').value,
                status: 'Ativo',
                dataCadastro: new Date().toISOString()
            };

            if (!atestado.funcionarioId || !atestado.dataInicio || !atestado.dataFim) {
                showNotification('Preencha os campos obrigat√≥rios', 'error');
                return;
            }

            sistemaData.atestados.push(atestado);
            salvarDados();
            renderizarAtestados();
            closeModal('atestadoModal');
            showNotification('Atestado registrado com sucesso!', 'success');
        }

        function renderizarAtestados() {
            const tbody = document.getElementById('atestadosTable');
            
            if (sistemaData.atestados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">Nenhum atestado registrado</td></tr>';
                return;
            }

            const atestadosOrdenados = sistemaData.atestados.sort((a, b) => new Date(b.dataInicio) - new Date(a.dataInicio));

            tbody.innerHTML = atestadosOrdenados.map(atestado => `
                <tr>
                    <td>${atestado.funcionarioNome}</td>
                    <td>${formatarData(atestado.dataInicio)}</td>
                    <td>${formatarData(atestado.dataFim)}</td>
                    <td>${atestado.dias}</td>
                    <td>${atestado.cid || '-'}</td>
                    <td><span class="badge badge-success">${atestado.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="excluirAtestado(${atestado.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function excluirAtestado(id) {
            if (confirm('Confirma a exclus√£o deste atestado?')) {
                sistemaData.atestados = sistemaData.atestados.filter(a => a.id !== id);
                salvarDados();
                renderizarAtestados();
                showNotification('Atestado exclu√≠do', 'success');
            }
        }

        // F√âRIAS
        function salvarFerias() {
            const funcionarioId = document.getElementById('feriasFuncionario').value;
            const funcionario = sistemaData.funcionarios.find(f => f.id == funcionarioId);
            
            const dataInicio = document.getElementById('feriasInicio').value;
            const dataFim = document.getElementById('feriasFim').value;
            
            const inicio = new Date(dataInicio);
            const fim = new Date(dataFim);
            const dias = Math.ceil((fim - inicio) / (1000 * 60 * 60 * 24)) + 1;

            const ferias = {
                id: Date.now(),
                funcionarioId: funcionarioId,
                funcionarioNome: funcionario?.nome || '',
                dataInicio: dataInicio,
                dataFim: dataFim,
                dias: dias,
                status: document.getElementById('feriasStatus').value,
                observacoes: document.getElementById('feriasObservacoes').value,
                dataCadastro: new Date().toISOString()
            };

            if (!ferias.funcionarioId || !ferias.dataInicio || !ferias.dataFim) {
                showNotification('Preencha os campos obrigat√≥rios', 'error');
                return;
            }

            sistemaData.ferias.push(ferias);
            salvarDados();
            renderizarFerias();
            closeModal('feriasModal');
            showNotification('F√©rias registradas com sucesso!', 'success');
        }

        function renderizarFerias() {
            const tbody = document.getElementById('feriasTable');
            
            if (sistemaData.ferias.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Nenhum per√≠odo registrado</td></tr>';
                return;
            }

            const feriasOrdenadas = sistemaData.ferias.sort((a, b) => new Date(b.dataInicio) - new Date(a.dataInicio));

            tbody.innerHTML = feriasOrdenadas.map(ferias => `
                <tr>
                    <td>${ferias.funcionarioNome}</td>
                    <td>${formatarData(ferias.dataInicio)}</td>
                    <td>${formatarData(ferias.dataFim)}</td>
                    <td>${ferias.dias}</td>
                    <td><span class="badge badge-${getStatusBadge(ferias.status)}">${ferias.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="excluirFerias(${ferias.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function excluirFerias(id) {
            if (confirm('Confirma a exclus√£o deste per√≠odo?')) {
                sistemaData.ferias = sistemaData.ferias.filter(f => f.id !== id);
                salvarDados();
                renderizarFerias();
                showNotification('Per√≠odo exclu√≠do', 'success');
            }
        }

        // TREINAMENTOS
        function calcularVencimento() {
            const dataRealizacao = document.getElementById('treinamentoData').value;
            const validadeMeses = document.getElementById('treinamentoValidade').value;
            
            if (dataRealizacao && validadeMeses) {
                const data = new Date(dataRealizacao);
                data.setMonth(data.getMonth() + parseInt(validadeMeses));
                document.getElementById('treinamentoVencimento').value = data.toISOString().split('T')[0];
            } else {
                document.getElementById('treinamentoVencimento').value = '';
            }
        }

        function salvarTreinamento() {
            const funcionarioId = document.getElementById('treinamentoFuncionario').value;
            const funcionario = sistemaData.funcionarios.find(f => f.id == funcionarioId);

            const treinamento = {
                id: Date.now(),
                funcionarioId: funcionarioId,
                funcionarioNome: funcionario?.nome || '',
                tipo: document.getElementById('treinamentoTipo').value,
                dataRealizacao: document.getElementById('treinamentoData').value,
                dataVencimento: document.getElementById('treinamentoVencimento').value,
                observacoes: document.getElementById('treinamentoObservacoes').value,
                status: 'V√°lido',
                dataCadastro: new Date().toISOString()
            };

            if (!treinamento.funcionarioId || !treinamento.tipo || !treinamento.dataRealizacao) {
                showNotification('Preencha os campos obrigat√≥rios', 'error');
                return;
            }

            sistemaData.treinamentos.push(treinamento);
            salvarDados();
            renderizarTreinamentos();
            closeModal('treinamentoModal');
            showNotification('Treinamento registrado com sucesso!', 'success');
        }

        function renderizarTreinamentos() {
            const tbody = document.getElementById('treinamentosTable');
            
            if (sistemaData.treinamentos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Nenhum treinamento registrado</td></tr>';
                return;
            }

            const treinamentosOrdenados = sistemaData.treinamentos.sort((a, b) => new Date(b.dataRealizacao) - new Date(a.dataRealizacao));

            tbody.innerHTML = treinamentosOrdenados.map(treinamento => {
                // Verificar se est√° vencendo
                let statusClass = 'success';
                let statusText = treinamento.status;
                
                if (treinamento.dataVencimento) {
                    const hoje = new Date();
                    const vencimento = new Date(treinamento.dataVencimento);
                    const diasRestantes = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                    
                    if (diasRestantes < 0) {
                        statusClass = 'danger';
                        statusText = 'Vencido';
                    } else if (diasRestantes <= 30) {
                        statusClass = 'warning';
                        statusText = 'Vencendo';
                    }
                }
                
                return `
                    <tr>
                        <td>${treinamento.funcionarioNome}</td>
                        <td>${treinamento.tipo}</td>
                        <td>${formatarData(treinamento.dataRealizacao)}</td>
                        <td>${treinamento.dataVencimento ? formatarData(treinamento.dataVencimento) : 'N√£o vence'}</td>
                        <td><span class="badge badge-${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="excluirTreinamento(${treinamento.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function excluirTreinamento(id) {
            if (confirm('Confirma a exclus√£o deste treinamento?')) {
                sistemaData.treinamentos = sistemaData.treinamentos.filter(t => t.id !== id);
                salvarDados();
                renderizarTreinamentos();
                showNotification('Treinamento exclu√≠do', 'success');
            }
        }

        // DASHBOARD
        function atualizarDashboard() {
            const funcionarios = sistemaData.funcionarios;
            
            document.getElementById('totalFuncionarios').textContent = funcionarios.length;
            document.getElementById('funcionariosAtivos').textContent = funcionarios.filter(f => f.status === 'Ativo').length;
            document.getElementById('funcionariosFerias').textContent = funcionarios.filter(f => f.status === 'F√©rias').length;
            document.getElementById('funcionariosAfastados').textContent = funcionarios.filter(f => f.status === 'Afastado').length;
            
            // Alertas
            const alertas = [];
            const hoje = new Date();
            
            // ASOs vencendo
            funcionarios.forEach(func => {
                if (func.aso) {
                    const vencimento = new Date(func.aso);
                    const dias = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                    
                    if (dias <= 0) {
                        alertas.push(`ASO vencido: ${func.nome}`);
                    } else if (dias <= 30) {
                        alertas.push(`ASO vencendo em ${dias} dias: ${func.nome}`);
                    }
                }
            });
            
            // Treinamentos vencendo
            sistemaData.treinamentos.forEach(treinamento => {
                if (treinamento.dataVencimento) {
                    const vencimento = new Date(treinamento.dataVencimento);
                    const dias = Math.ceil((vencimento - hoje) / (1000 * 60 * 60 * 24));
                    
                    if (dias <= 0) {
                        alertas.push(`Treinamento vencido: ${treinamento.tipo} - ${treinamento.funcionarioNome}`);
                    } else if (dias <= 30) {
                        alertas.push(`Treinamento vencendo em ${dias} dias: ${treinamento.tipo} - ${treinamento.funcionarioNome}`);
                    }
                }
            });
            
            const alertasContainer = document.getElementById('alertasContainer');
            if (alertas.length === 0) {
                alertasContainer.innerHTML = '<p class="text-center text-muted">Nenhum alerta no momento</p>';
            } else {
                alertasContainer.innerHTML = alertas.map(alerta => `
                    <div style="padding: 0.75rem; background: var(--warning); color: white; border-radius: 0.5rem; margin-bottom: 0.5rem;">
                        <i class="fas fa-exclamation-triangle"></i> ${alerta}
                    </div>
                `).join('');
            }
        }

        // RELAT√ìRIOS
        function gerarRelatorioSupervisor() {
            const dados = sistemaData.funcionarios.reduce((acc, func) => {
                if (func.supervisor) {
                    if (!acc[func.supervisor]) {
                        acc[func.supervisor] = [];
                    }
                    acc[func.supervisor].push(func);
                }
                return acc;
            }, {});
            
            let relatorio = 'RELAT√ìRIO POR SUPERVISOR\n\n';
            
            Object.keys(dados).forEach(letra => {
                const supervisor = ESCALAS[letra];
                relatorio += `Supervisor ${supervisor?.nome || letra} (Letra ${letra}):\n`;
                relatorio += `Total: ${dados[letra].length} funcion√°rios\n`;
                dados[letra].forEach(func => {
                    relatorio += `- ${func.nome} (${func.matricula}) - ${func.funcao}\n`;
                });
                relatorio += '\n';
            });
            
            baixarArquivo('relatorio-supervisor.txt', relatorio);
        }

        function gerarRelatorioFaltas() {
            let relatorio = 'RELAT√ìRIO DE FALTAS\n\n';
            
            const faltasOrdenadas = sistemaData.faltas.sort((a, b) => new Date(b.data) - new Date(a.data));
            
            faltasOrdenadas.forEach(falta => {
                relatorio += `Data: ${formatarData(falta.data)}\n`;
                relatorio += `Funcion√°rio: ${falta.funcionarioNome}\n`;
                relatorio += `Motivo: ${falta.motivo}\n`;
                relatorio += `Cobertura: ${falta.coberturaNome || 'Nenhuma'}\n`;
                if (falta.observacoes) {
                    relatorio += `Observa√ß√µes: ${falta.observacoes}\n`;
                }
                relatorio += '\n';
            });
            
            baixarArquivo('relatorio-faltas.txt', relatorio);
        }

        function gerarRelatorioTreinamentos() {
            let relatorio = 'RELAT√ìRIO DE TREINAMENTOS\n\n';
            
            const treinamentosOrdenados = sistemaData.treinamentos.sort((a, b) => new Date(b.dataRealizacao) - new Date(a.dataRealizacao));
            
            treinamentosOrdenados.forEach(treinamento => {
                relatorio += `Funcion√°rio: ${treinamento.funcionarioNome}\n`;
                relatorio += `Tipo: ${treinamento.tipo}\n`;
                relatorio += `Data: ${formatarData(treinamento.dataRealizacao)}\n`;
                relatorio += `Vencimento: ${treinamento.dataVencimento ? formatarData(treinamento.dataVencimento) : 'N√£o vence'}\n`;
                if (treinamento.observacoes) {
                    relatorio += `Observa√ß√µes: ${treinamento.observacoes}\n`;
                }
                relatorio += '\n';
            });
            
            baixarArquivo('relatorio-treinamentos.txt', relatorio);
        }

        // CONFIGURA√á√ïES
        function salvarConfiguracao() {
            sistemaData.config.appsScriptUrl = document.getElementById('appsScriptUrl').value;
            sistemaData.config.spreadsheetId = document.getElementById('spreadsheetId').value;
            salvarDados();
            showNotification('Configura√ß√£o salva!', 'success');
        }

        function testarConexao() {
            const url = sistemaData.config.appsScriptUrl;
            if (!url) {
                showNotification('Configure a URL primeiro', 'warning');
                return;
            }
            
            showNotification('Testando conex√£o...', 'info');
            
            // Usar JSONP como alternativa ao CORS
            const script = document.createElement('script');
            const callbackName = 'callback_' + Date.now();
            
            // Timeout para a requisi√ß√£o
            const timeout = setTimeout(() => {
                document.head.removeChild(script);
                delete window[callbackName];
                showNotification('Timeout na conex√£o - Verifique a URL', 'error');
            }, 10000);
            
            window[callbackName] = function(data) {
                clearTimeout(timeout);
                document.head.removeChild(script);
                delete window[callbackName];
                
                if (data && (data.success || data.message)) {
                    showNotification('Conex√£o estabelecida com sucesso!', 'success');
                } else {
                    showNotification('Erro na resposta do servidor', 'error');
                }
            };
            
            script.src = `${url}?action=test&callback=${callbackName}`;
            script.onerror = function() {
                clearTimeout(timeout);
                document.head.removeChild(script);
                delete window[callbackName];
                showNotification('Erro na conex√£o - Verifique se o Apps Script foi publicado corretamente', 'error');
            };
            
            document.head.appendChild(script);
        }

        function sincronizar() {
            const url = sistemaData.config.appsScriptUrl;
            if (!url) {
                showNotification('Configure a integra√ß√£o primeiro', 'warning');
                return;
            }
            
            showNotification('Sincronizando dados...', 'info');
            
            // Criar um formul√°rio oculto para POST (contorna CORS)
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = url;
            form.target = '_blank'; // Abre em nova aba para n√£o sair da aplica√ß√£o
            form.style.display = 'none';
            
            // Adicionar dados como campos ocultos
            const actionField = document.createElement('input');
            actionField.type = 'hidden';
            actionField.name = 'action';
            actionField.value = 'write';
            form.appendChild(actionField);
            
            const tabField = document.createElement('input');
            tabField.type = 'hidden';
            tabField.name = 'tab';
            tabField.value = 'Funcionarios';
            form.appendChild(tabField);
            
            const dataField = document.createElement('input');
            dataField.type = 'hidden';
            dataField.name = 'data';
            dataField.value = JSON.stringify(sistemaData.funcionarios);
            form.appendChild(dataField);
            
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
            
            showNotification('Dados enviados! Verifique a planilha.', 'success');
        }

        // BACKUP
        function fazerBackup() {
            const backup = {
                data: new Date().toISOString(),
                dados: sistemaData
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-grupogps-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            showNotification('Backup criado!', 'success');
        }

        function restaurarBackup(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    if (backup.dados && confirm('Restaurar backup? Isso substituir√° todos os dados atuais.')) {
                        sistemaData = backup.dados;
                        salvarDados();
                        atualizarDashboard();
                        showNotification('Backup restaurado!', 'success');
                        location.reload(); // Recarregar para atualizar todas as telas
                    }
                } catch (error) {
                    showNotification('Arquivo inv√°lido', 'error');
                }
            };
            reader.readAsText(file);
        }

        // UTILIDADES
        function formatarData(data) {
            if (!data) return '-';
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function getBadgeClass(status) {
            switch(status) {
                case 'Ativo': return 'success';
                case 'F√©rias': return 'info';
                case 'Afastado': return 'warning';
                case 'Desligado': return 'danger';
                default: return 'secondary';
            }
        }

        function getMotivoBadge(motivo) {
            switch(motivo) {
                case 'Atestado M√©dico': return 'info';
                case 'Falta Justificada': return 'warning';
                case 'Falta Injustificada': return 'danger';
                default: return 'secondary';
            }
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'Programado': return 'warning';
                case 'Em andamento': return 'info';
                case 'Conclu√≠do': return 'success';
                default: return 'secondary';
            }
        }

        function baixarArquivo(nome, conteudo) {
            const blob = new Blob([conteudo], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = nome;
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'exclamation'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // PERSIST√äNCIA
        function salvarDados() {
            try {
                localStorage.setItem('grupogps-sistema', JSON.stringify(sistemaData));
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
            }
        }

        function carregarDados() {
            try {
                const dados = localStorage.getItem('grupogps-sistema');
                if (dados) {
                    const dadosCarregados = JSON.parse(dados);
                    // Merge com estrutura padr√£o para compatibilidade
                    sistemaData = {
                        funcionarios: dadosCarregados.funcionarios || [],
                        faltas: dadosCarregados.faltas || [],
                        atestados: dadosCarregados.atestados || [],
                        ferias: dadosCarregados.ferias || [],
                        treinamentos: dadosCarregados.treinamentos || [],
                        config: dadosCarregados.config || { appsScriptUrl: '', spreadsheetId: '' }
                    };
                    
                    // Carregar configura√ß√µes nos inputs
                    setTimeout(() => {
                        document.getElementById('appsScriptUrl').value = sistemaData.config.appsScriptUrl || '';
                        document.getElementById('spreadsheetId').value = sistemaData.config.spreadsheetId || '';
                    }, 100);
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        console.log('Sistema GrupoGPS v2.0 - Totalmente funcional');
    </script>
</body>
</html>
